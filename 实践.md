# Chproxy 学习实践

## 编译
clone 下来以后 运行 `go build` 即可

## 配置测试：

```yaml
# 测试配置
# 日志级别
log_debug: true

server:
  http:
    # echo 'select * from system.clusters' | curl 'http://192.168.124.3:9090/?user=chproxy&password=123456' --data-binary @-
    listen_addr: "192.168.124.3:9090"
    allowed_networks: ["127.0.0.0/24", "192.168.124.0/24"]

users:
  - name: "chproxy"
#    password: "123456"
    # 访问哪个集群
    to_cluster: "default"
    # 以哪个用户账号访问
    to_user: "admin"

clusters:
  # 集群名
  - name: "default"
    # 集群列表
    nodes: ["192.168.180.128:8123"]
    # 访问ch 账号密码
    users:
      - name: "admin"
        password: "chadmin"
```



## 终端请求测试：

```shell
➜  ~ echo 'select * from system.clusters' | curl 'http://192.168.124.3:9090/?user=chproxy&password=123456' --data-binary @-
test_cluster_two_shards	1	1	1	127.0.0.1	127.0.0.1	9000	1	default		0	0	0
test_cluster_two_shards	2	1	1	127.0.0.2	127.0.0.2	9000	0	default		0	0	0
test_cluster_two_shards_internal_replication	1	1	1	127.0.0.1	127.0.0.1	9000	1	default		0	0	0
test_cluster_two_shards_internal_replication	2	1	1	127.0.0.2	127.0.0.2	9000	0	default		0	0	0
test_cluster_two_shards_localhost	1	1	1	localhost	127.0.0.1	9000	1	default		0	0	0
test_cluster_two_shards_localhost	2	1	1	localhost	127.0.0.1	9000	1	default		0	0	0
test_shard_localhost	1	1	1	localhost	127.0.0.1	9000	1	default		0	0	0
test_shard_localhost_secure	1	1	1	localhost	127.0.0.1	9440	0	default		0	0	0
test_unavailable_shard	1	1	1	localhost	127.0.0.1	9000	1	default		0	0	0
test_unavailable_shard	2	1	1	localhost	127.0.0.1	1	0	default		0	0	0
➜  ~
```

```shell
# echo "show databases;" | curl -u chproxy: --data-binary @- 127.0.0.1:9090
# echo "select hostname()" | curl -u chproxy: --data-binary @- 127.0.0.1:9090
# echo "insert into test.insert_test values (2, 'aaaa');" | curl -u chproxy: --data-binary @- 127.0.0.1:9090
```

## 工具模拟测试：

![chproxy 工具模拟请求调试](./img/chproxy 工具模拟请求调试.png)

<img src="./img/chproxy 工具模拟请求调试_2.png" alt="chproxy 工具模拟请求调试_2" style="zoom:100%;" />

